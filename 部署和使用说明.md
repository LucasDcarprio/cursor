# 泓枢智创 - 智慧采购管理系统

## 系统部署和使用说明

### 项目概述

泓枢智创智慧采购管理系统是一款面向零售连锁企业、商超等多门店经营实体的SaaS采购管理平台。系统提供了完整的采购管理解决方案，支持多租户、多门店管理，深度集成阿里巴巴1688平台。

### 技术栈
- **后端**: Flask 2.3.3 + SQLAlchemy 2.0.35 + SQLite
- **前端**: Bootstrap 5 + Vue 3 + Element Plus
- **认证**: Flask-Login + JWT
- **文件处理**: openpyxl
- **API集成**: requests

## 部署指南

### 1. 环境要求
- Python 3.8+ (推荐 3.10+)
- SQLite 3
- 现代浏览器 (Chrome, Firefox, Safari, Edge)

### 2. 快速部署

#### 步骤1: 克隆项目
```bash
git clone <项目地址>
cd procurement-system
```

#### 步骤2: 安装依赖
```bash
# 创建虚拟环境（推荐）
python3 -m venv venv
source venv/bin/activate  # Linux/Mac
# 或
venv\Scripts\activate     # Windows

# 安装依赖
pip install -r requirements.txt
```

#### 步骤3: 初始化数据库
```bash
python3 simple_init.py
```

#### 步骤4: 启动应用
```bash
python3 main.py
```

访问 http://localhost:5000 即可使用系统。

### 3. 生产环境部署

#### 使用Gunicorn部署
```bash
# 安装Gunicorn
pip install gunicorn

# 启动应用
gunicorn -w 4 -b 0.0.0.0:5000 main:app
```

#### 使用Nginx反向代理
```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
    
    location /static {
        alias /path/to/your/project/static;
        expires 30d;
    }
}
```

## 使用指南

### 1. 默认管理员账户
- **用户名**: admin
- **密码**: admin123
- **角色**: 超级管理员

⚠️ **安全提醒**: 首次登录后请立即修改默认密码！

### 2. 主要功能模块

#### 2.1 用户管理（超级管理员专用）
- 查看和管理所有用户
- 设置用户角色（super/admin/user）
- 控制用户到期时间和最大门店数量
- 用户权限分配

#### 2.2 门店管理
- 添加和编辑门店信息
- 配置门店配送地址
- 设置阿里巴巴API凭证
- 数据权限隔离（仅归属人和super可访问）

#### 2.3 基础数据管理
- 商品信息维护（SKU、价格、规格等）
- 支持Excel批量导入导出
- 供应商信息管理
- 价格历史记录

#### 2.4 采购订单管理
- 创建和编辑采购订单
- 订单状态跟踪（待处理→处理中→已发货→已送达→已完成）
- 收货确认管理
- 批量操作支持

#### 2.5 阿里巴巴API集成
- 商品信息查询
- 自动下单功能
- 订单支付管理
- 物流信息同步

#### 2.6 数据管理
- Excel数据导入导出
- 操作日志记录
- 数据统计分析

### 3. 权限体系

#### 3.1 角色权限
- **super（超级管理员）**: 拥有所有权限，可管理用户和系统配置
- **admin（管理员）**: 可管理自己的数据和门店
- **user（普通用户）**: 仅能操作自己门店的数据

#### 3.2 数据隔离
- 每个用户只能访问自己创建的数据
- 超级管理员可以访问所有数据
- 门店、商品、订单都有归属人字段控制访问权限

### 4. API接口

#### 4.1 认证
```bash
# 获取访问令牌
curl -X POST http://localhost:5000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
```

#### 4.2 使用API
```bash
# 获取门店列表
curl -X GET http://localhost:5000/api/stores \
  -H "Authorization: Bearer YOUR_TOKEN"

# 创建商品
curl -X POST http://localhost:5000/api/products \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"product_name":"测试商品","sku_code":"TEST001"}'
```

### 5. 数据导入导出

#### 5.1 Excel导入
1. 准备Excel文件，确保列标题与系统字段匹配
2. 在管理后台点击"数据导入"
3. 选择数据类型（商品/订单）
4. 上传Excel文件

#### 5.2 Excel导出
1. 在管理后台点击"数据导出"
2. 选择要导出的数据类型
3. 系统自动生成Excel文件下载

### 6. 阿里巴巴API配置

#### 6.1 获取API凭证
1. 登录阿里巴巴开放平台
2. 创建应用获取 AppKey 和 AppSecret
3. 配置回调地址和权限

#### 6.2 系统配置
1. 编辑 `config.py` 文件
2. 填入真实的API凭证
3. 在门店管理中配置具体门店的API信息

```python
# config.py
API_KEY = 'your_real_api_key'
API_SECRET = 'your_real_api_secret'
API_TOKEN = 'your_real_api_token'
```

### 7. 常见问题

#### 7.1 数据库问题
**Q: 如何重置数据库？**
A: 删除 `data.db` 文件，重新运行 `python3 simple_init.py`

**Q: 如何备份数据？**
A: 直接复制 `data.db` 文件即可

#### 7.2 权限问题
**Q: 用户看不到数据？**
A: 检查数据的 `from_user` 字段是否正确，确保数据归属正确

**Q: 如何重置管理员密码？**
A: 删除数据库中的admin用户记录，重新运行初始化脚本

#### 7.3 API问题
**Q: 阿里巴巴API调用失败？**
A: 检查API凭证配置、网络连接和API权限

### 8. 开发和扩展

#### 8.1 项目结构
```
procurement-system/
├── app/                    # 应用目录
│   ├── __init__.py        # 应用初始化
│   ├── models/            # 数据模型
│   ├── views/             # 视图层
│   └── utils/             # 工具函数
├── templates/             # HTML模板
├── static/               # 静态文件
├── uploads/              # 上传文件
├── main.py               # 应用入口
├── config.py             # 配置文件
├── requirements.txt      # 依赖包
└── alibaba_api.py        # 阿里巴巴API集成
```

#### 8.2 添加新功能
1. 在 `app/models/` 中定义数据模型
2. 在 `app/views/` 中添加视图函数
3. 在 `templates/` 中创建HTML模板
4. 更新路由和权限配置

#### 8.3 数据库迁移
```python
# 添加新字段后
from app import db
with app.app_context():
    db.create_all()  # 创建新表和字段
```

### 9. 性能优化

#### 9.1 数据库优化
- 为常用查询字段添加索引
- 定期清理历史数据
- 使用分页查询避免大数据量加载

#### 9.2 应用优化
- 启用Gzip压缩
- 配置静态文件缓存
- 使用CDN加速前端资源

### 10. 安全建议

#### 10.1 生产环境安全
- 修改默认密码和Secret Key
- 启用HTTPS
- 配置防火墙规则
- 定期备份数据

#### 10.2 API安全
- 使用强密码策略
- 限制API调用频率
- 监控异常访问

### 11. 技术支持

如有技术问题，请按以下步骤排查：

1. 检查系统日志
2. 验证配置文件
3. 确认网络连接
4. 查看错误信息

## 联系信息

- 项目名称：泓枢智创 - 智慧采购管理系统
- 版本：v1.0.0
- 开发时间：2024年
- 适用场景：零售连锁企业、商超、便利店采购管理

---

*本文档最后更新时间：2024年*